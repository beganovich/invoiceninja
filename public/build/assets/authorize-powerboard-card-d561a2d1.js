import{i,w as u}from"./wait-8f4ae121.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2024. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */async function d(){const t={name:navigator.userAgent.substring(0,100),java_enabled:navigator.javaEnabled()?"true":"false",language:navigator.language||navigator.userLanguage,screen_height:window.screen.height.toString(),screen_width:window.screen.width.toString(),time_zone:(new Date().getTimezoneOffset()*-1).toString(),color_depth:window.screen.colorDepth.toString()};document.querySelector('input[name="browser_details"]').value=JSON.stringify(t);const r=JSON.stringify(Object.fromEntries(new FormData(document.getElementById("server-response"))));try{const n=await fetch(document.querySelector("meta[name=store_route]").content,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').content},body:r});return n.ok?await n.json():await n.json().then(e=>{throw new Error(e.message??"Unknown error.")})}catch(n){throw document.getElementById("errors").textContent=`Sorry, your transaction could not be processed...

${n.message}`,document.getElementById("errors").hidden=!1,console.error("Fetch error:",n),n}}async function m(){try{const t=await d();if(t.status==="not_authenticated")throw new Error("There was an issue authenticating this payment method.");if(t.status==="authentication_not_supported")return document.querySelector('input[name="browser_details"]').value=null,document.querySelector('input[name="charge"]').value=JSON.stringify(t),document.getElementById("server-response").submit();const r=new cba.Canvas3ds("#widget-3dsecure",t._3ds.token);r.on("chargeAuthSuccess",function(e){document.querySelector('input[name="browser_details"]').value=null,document.querySelector('input[name="charge"]').value=JSON.stringify(e),document.getElementById("server-response").submit()}),r.on("chargeAuthReject",function(e){document.getElementById("errors").textContent="Sorry, your transaction could not be processed...",document.getElementById("errors").hidden=!1}),r.load(),document.getElementById("widget").classList.add("hidden")}catch(t){console.error("Error fetching 3DS Token:",t),document.getElementById("errors").textContent=`Sorry, your transaction could not be processed...

${t}`,document.getElementById("errors").hidden=!1}}function c(){const t=document.querySelector("meta[name=public_key]"),r=document.querySelector("meta[name=gateway_id]"),n=document.querySelector("meta[name=environment]"),e=new cba.HtmlWidget("#widget",t==null?void 0:t.content,r==null?void 0:r.content);e.setEnv(n.content),e.useAutoResize(),e.onFinishInsert('input[name="gateway_response"]',"payment_source"),e.load();function o(){let a=document.getElementById("pay-now");a.disabled=e.isInvalidForm()}e.trigger("tab",o),e.trigger("submit_form",o),e.trigger("tab",o),e.on("submit",async function(a){document.getElementById("errors").hidden=!0}),e.on("finish",async function(a){document.getElementById("errors").hidden=!0,m()});const s=document.querySelector('input[name="payment-type"]');s&&s.click()}i()?c():u("#foo").then(c);
