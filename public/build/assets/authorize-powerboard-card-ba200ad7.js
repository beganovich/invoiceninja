import{i as m,w as g}from"./wait-8f4ae121.js";/**
 * Invoice Ninja (https://invoiceninja.com).
 *
 * @link https://github.com/invoiceninja/invoiceninja source repository
 *
 * @copyright Copyright (c) 2024. Invoice Ninja LLC (https://invoiceninja.com)
 *
 * @license https://www.elastic.co/licensing/elastic-license
 */async function y(){const n={name:navigator.userAgent.substring(0,100),java_enabled:navigator.javaEnabled()?"true":"false",language:navigator.language||navigator.userLanguage,screen_height:window.screen.height.toString(),screen_width:window.screen.width.toString(),time_zone:(new Date().getTimezoneOffset()*-1).toString(),color_depth:window.screen.colorDepth.toString()};document.querySelector('input[name="browser_details"]').value=JSON.stringify(n);const o=JSON.stringify(Object.fromEntries(new FormData(document.getElementById("server-response"))));try{const t=await fetch(document.querySelector("meta[name=store_route]").content,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-Token":document.querySelector('meta[name="csrf-token"]').content},body:o});return t.ok?await t.json():await t.json().then(e=>{throw new Error(e.message??"Unknown error.")})}catch(t){throw document.getElementById("errors").textContent=`Sorry, your transaction could not be processed...

${t.message}`,document.getElementById("errors").hidden=!1,console.error("Fetch error:",t),t}}function l(){const n=document.querySelector("meta[name=public_key]"),o=document.querySelector("meta[name=gateway_id]"),t=document.querySelector("meta[name=environment]"),e=new cba.HtmlWidget("#widget",n==null?void 0:n.content,o==null?void 0:o.content);e.setEnv(t.content),e.useAutoResize(),e.interceptSubmitForm("#server-response"),e.onFinishInsert('input[name="gateway_response"]',"payment_source"),e.load();function d(){let a=document.getElementById("pay-now");a.disabled=e.isInvalidForm()}e.trigger("tab",d),e.trigger("submit_form",d),e.trigger("tab",d),e.on("submit",async function(a){document.getElementById("errors").hidden=!0}),e.on("finish",async function(a){document.getElementById("errors").hidden=!0,console.log("finish",a);try{const r=await y();console.log("3DS Token:",r),console.log("pre canvas"),console.log(r._3ds.token);const c=new cba.Canvas3ds("#widget-3dsecure",r._3ds.token);c.load(),document.getElementById("widget").classList.add("hidden"),c.on("chargeAuthSuccess",function(i){console.log(i),document.querySelector('input[name="browser_details"]').value=null,document.querySelector('input[name="charge"]').value=JSON.stringify(i),document.getElementById("server-response").submit()}),c.on("chargeAuthReject",function(i){console.log(i),document.getElementById("errors").textContent="Sorry, your transaction could not be processed...",document.getElementById("errors").hidden=!1}),c.load()}catch(r){console.error("Error fetching 3DS Token:",r)}});const s=document.getElementById("authorize-card");s.addEventListener("click",()=>{e.isValidForm()&&(s.disabled=e,s.querySelector("svg").classList.remove("hidden"),s.querySelector("span").classList.add("hidden")),document.getElementById("stub").click()});const u=document.querySelector('input[name="payment-type"]');u&&u.click()}m()?l():g("#foo").then(l);
